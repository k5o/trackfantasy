.dashboard
  %aside
    = render partial: 'sidebar'
  %main
    .main-header
      %span.filter-title Filters:
      = form_tag '/dashboard/fetch_dashboard_data', method: 'get', id: 'filter' do
        = label_tag 'From:'
        = date_field_tag 'from_date', @date_range.try(:first).try(:to_date)
        = label_tag 'To:'
        = date_field_tag 'to_date', @date_range.try(:last).try(:to_date) || Date.today
        = select_tag "sport", options_for_select(Entry::SPORTS, @sport), include_blank: 'Sport:'
        = select_tag "site", options_for_select(Site::NAMES, @site), include_blank: 'Site:'
        .header-actions
          = submit_tag 'Filter', id: 'js-filter-btn', class: 'header-btn filter-btn'
          = link_to 'Reset', dashboard_path, class: 'header-btn reset-btn'
          = icon('cog', '', class: 'fa-spin js-filter-loader')
    = render partial: 'partials/flash'
    .main-container
      = icon('cog', '', class: 'fa-4x fa-spin')

:javascript
  $(function () {
    function getUrlParameter(sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) { return sParameterName[1]; }
      }
    }

    var fromDate = getUrlParameter('from_date');
    var toDate = getUrlParameter('to_date');
    var site = getUrlParameter('site');
    var sport = getUrlParameter('sport');

    $.ajax({
      url: '/dashboard/fetch_dashboard_data',
      data: {from_date: fromDate, to_date: toDate, site: site, sport: sport},
      type: 'GET',
    }).success(function(data){
      $('.main-container').html(data);
    }).fail(function(data){
      $('.main-errors').append('Something went wrong, please make sure your date input is valid. <a href="/dashboard">Refresh</a>').show();
    });
  });
